spring.application.name=aiagent

# Spring AI Configuration
# Google Gemini 설정
# 방법 1: 환경 변수 사용 (권장): export GEMINI_API_KEY=your-key-here
# 방법 2: 아래에 직접 입력 (개발 환경용, 프로덕션에서는 사용하지 마세요)
# 프로덕션 환경에서는 반드시 환경 변수 사용: spring.ai.google.genai.api-key=${GEMINI_API_KEY}
spring.ai.google.genai.api-key=${GEMINI_API_KEY}
spring.ai.google.genai.chat.options.model=gemini-2.5-flash
spring.ai.google.genai.chat.options.temperature=0.7

# Spring AI 자동 설정
# AiConfig에서 명시적으로 ChatModel을 생성하므로 자동 설정과 충돌 방지를 위해 비활성화
# spring.ai.model.chat=google-genai

# Spring AI 자동 설정 비활성화
# AiConfig에서 ChatModel을 명시적으로 생성하므로 자동 설정을 비활성화합니다
spring.autoconfigure.exclude=org.springframework.ai.model.google.genai.autoconfigure.chat.GoogleGenAiChatAutoConfiguration

# Spring AI Embedding 설정
# Google GenAI Embedding을 사용합니다 (auto-configuration)
# gemini-embedding-001: 최신 통합 모델 (100+ 언어 지원, 최고 성능)
# - 3072 차원: 최고 품질 (기본값)
# - 1536 차원: 성능과 비용의 균형 (권장)
# - 768 차원: 빠른 검색 속도
spring.ai.model.embedding.text=google-genai
spring.ai.google.genai.embedding.api-key=${GEMINI_API_KEY}
spring.ai.google.genai.embedding.text.options.model=gemini-embedding-001
spring.ai.google.genai.embedding.text.options.task-type=RETRIEVAL_DOCUMENT
# output-dimensionality 설정 (kebab-case)
# 주의: Spring AI의 auto-configuration이 이 설정을 제대로 읽지 못할 수 있습니다.
# 만약 3072 차원이 생성된다면, 아래 camelCase 형식도 시도해보세요.
spring.ai.google.genai.embedding.text.options.output-dimensionality=1536
# spring.ai.google.genai.embedding.text.options.outputDimensionality=1536
# 자동 잘림 활성화 (2,048 토큰 초과 시 자동으로 잘림, 기본값: false)
# 주의: 이 옵션을 true로 설정하면 긴 텍스트가 잘릴 수 있으므로, 
# 대신 ConsultationEmbeddingService에서 청크로 나누는 방식을 사용합니다.
# spring.ai.google.genai.embedding.text.options.auto-truncate=false

# Ollama 사용 시 주석 해제하고 Google GenAI 설정 주석 처리
# spring.ai.ollama.base-url=http://localhost:11434
# spring.ai.ollama.chat.options.model=llama3

# LangGraph4j Configuration
langgraph4j.checkpoint.enabled=true
langgraph4j.checkpoint.dir=./checkpoints

# Actuator endpoints
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized

# ============================================
# Swagger (SpringDoc OpenAPI) Configuration
# ============================================
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.path=/swagger-ui
springdoc.swagger-ui.operations-sorter=method

# Agent Configuration
agent.max-iterations=5

# ============================================
# Database Configuration (PostgreSQL)
# ============================================
# PostgreSQL 연결 설정
# 환경 변수 사용 권장: export DB_URL=jdbc:postgresql://localhost:5432/consultation_db
#                     export DB_USERNAME=your_username
#                     export DB_PASSWORD=your_password
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/consultation_db}
spring.datasource.username=${DB_USER:postgres}
spring.datasource.password=${DB_PASSWORD:postgres}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate 설정
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.show_sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.highlight_sql=true
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=trace

# PostgreSQL pgvector 설정
# pgvector 확장이 설치되어 있어야 합니다
# PostgreSQL에서 실행: CREATE EXTENSION IF NOT EXISTS vector;
# 
# EmbeddingConfig에서 outputDimensionality=1536을 명시적으로 설정하므로
# 모델이 1536 차원을 생성합니다.
spring.ai.vectorstore.pgvector.index-type=HNSW
spring.ai.vectorstore.pgvector.distance-type=COSINE_DISTANCE
spring.ai.vectorstore.pgvector.dimensions=1536

# ============================================
# Counsel 테이블 연결 설정
# ============================================
# Counsel 테이블이 다른 DB에 있는 경우 아래 설정 사용
# 같은 DB인 경우 위의 spring.datasource 설정 사용
# 
# 방법 1: 같은 PostgreSQL 인스턴스의 다른 데이터베이스
# spring.datasource.url=jdbc:postgresql://localhost:5432/original_db
# 
# 방법 2: 다른 서버의 데이터베이스 (다중 데이터소스 설정 필요)
# counsel.datasource.url=jdbc:postgresql://other-server:5432/original_db
# counsel.datasource.username=readonly_user
# counsel.datasource.password=readonly_password

