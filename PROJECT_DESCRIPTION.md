# AIAgent 프로젝트 설명 보고서

## 📋 프로젝트 개요

**AIAgent**는 LangGraph4j와 Spring AI를 기반으로 구축된 지능형 법률 상담 AI 에이전트 시스템입니다. RAG(Retrieval-Augmented Generation) 패턴을 활용하여 법률 관련 지식베이스를 벡터 검색하고, Google Gemini API를 통해 정확하고 맥락에 맞는 답변을 생성합니다.

### 핵심 가치

이 프로젝트의 핵심 가치는 **데이터 기반 AI 기능 강화**입니다. 다양한 법률 관련 데이터 소스를 통합할수록 AI 에이전트의 답변 품질과 정확도가 지속적으로 향상되는 확장 가능한 아키텍처를 제공합니다.

---

## 🎯 프로젝트 목적

### 주요 목적

1. **법률 상담 자동화**: 사용자의 법률 질문에 대해 관련 법령과 과거 상담 사례를 기반으로 정확한 답변 제공
2. **지식베이스 통합**: 다양한 법률 관련 데이터 소스를 벡터 스토어에 통합하여 통합 검색 및 활용
3. **확장 가능한 AI 시스템**: 새로운 데이터 소스 추가 시 기존 시스템 수정 없이 자동으로 AI 기능 강화

### 비즈니스 가치

- **효율성 향상**: 법률 전문가의 상담 시간 단축 및 반복적인 질문에 대한 즉각적인 답변 제공
- **일관성 보장**: 동일한 질문에 대해 일관된 답변 제공으로 서비스 품질 향상
- **지속적 개선**: 데이터가 추가될수록 자동으로 AI 성능이 향상되는 자기 진화형 시스템

---

## 🏗️ 시스템 아키텍처

### 기술 스택

- **프레임워크**: Spring Boot 3.5.1, Spring AI 1.1.1
- **AI 에이전트**: LangGraph4j 1.7.5
- **LLM**: Google Gemini API (gemini-3-flash-preview)
- **임베딩 모델**: Google Gemini text-embedding-004 (768차원)
- **벡터 스토어**: PostgreSQL pgvector
- **세션 관리**: Redis

### 핵심 아키텍처 패턴

#### 1. RAG (Retrieval-Augmented Generation) 패턴

```
사용자 질문
    ↓
[벡터 임베딩 변환]
    ↓
[유사도 검색] → 관련 문서 검색 (법령, 상담 사례 등)
    ↓
[컨텍스트 구성] → 검색 결과를 LLM 컨텍스트로 제공
    ↓
[답변 생성] → LLM이 컨텍스트 기반으로 답변 생성
```

#### 2. LangGraph 기반 에이전트 워크플로우

```
InputNode → 사용자 입력 처리
    ↓
LlmNode → LLM 호출 (자동으로 Tool 선택 및 실행)
    ├─ SearchTool: 벡터 검색 수행
    ├─ CalculatorTool: 수학 계산
    └─ WeatherTool: 날씨 조회
    ↓
ConditionalNode → 다음 단계 결정
    ↓
ResponseNode → 최종 응답 생성
```

#### 3. 확장 가능한 메타데이터 구조

모든 문서 타입은 `DocumentMetadata` 인터페이스를 구현하여:

- 벡터 스토어에 일관된 형식으로 저장
- 검색 시 문서 타입별 필터링 가능
- 새로운 문서 타입 추가 시 기존 코드 수정 최소화

---

## 📊 현재 지원 데이터 소스

### 1. 법령 조문 (LawArticle)

**메타데이터**: `LawArticleMetadata`

**포함 정보**:

- 법령 기본 정보: 법령 ID, 법령명, 시행일자, 법종 구분
- 조문 정보: 조문 키, 조문 코드, 조문 번호, 조문제목, 조문 내용
- 청크 정보: 긴 조문의 경우 청크 단위로 분할

**활용 방식**:

- 사용자 질문과 관련된 법령 조문을 벡터 유사도 검색으로 찾아냄
- 상담 사례와 연관된 법령 조문을 자동으로 함께 검색
- 법령 조문의 정확한 내용을 답변에 인용

**예시**:

```
질문: "부가가치세 신고 기한이 언제인가요?"
→ 관련 법령 조문 검색: "부가가치세법 제 18조" 등
→ 조문 내용을 기반으로 정확한 답변 생성
```

### 2. 상담 데이터 (Counsel)

**메타데이터**: `CounselMetadata`

**포함 정보**:

- 상담 기본 정보: 상담 ID, 제목, 분야, 생성일시
- 연관 법령 정보: 연관된 법령 ID, 조문 키, 법령-조문 쌍
- 청크 정보: 긴 상담 내용의 경우 청크 단위로 분할

**활용 방식**:

- 과거 유사한 상담 사례를 검색하여 참고
- 상담 사례에 연관된 법령 조문을 자동으로 함께 검색
- 실제 상담 사례를 바탕으로 구체적이고 실용적인 답변 제공

**예시**:

```
질문: "외국인 투자자에게 배당금을 지급할 때 원천징수율은?"
→ 유사한 과거 상담 사례 검색
→ 관련 법령 조문 자동 검색
→ 실제 사례와 법령을 결합한 답변 생성
```

### 3. 하이브리드 검색 전략

현재 시스템은 **하이브리드 검색**을 통해 두 데이터 소스를 통합 활용합니다:

1. **상담 데이터 검색**: 사용자 질문과 유사한 과거 상담 사례 검색
2. **법령 데이터 검색**: 사용자 질문과 관련된 법령 조문 검색
3. **연관 법령 자동 검색**: 상담 사례에 연관된 법령 조문을 추가로 검색
4. **결과 통합**: 중복 제거 후 관련성 높은 순서로 정렬하여 LLM에 제공

이를 통해 **법령의 정확성**과 **실무 사례의 구체성**을 동시에 확보합니다.

---

## 🚀 향후 확장 가능한 데이터 소스

프로젝트의 확장 가능한 아키텍처를 통해 다음과 같은 데이터 소스를 추가할 수 있으며, 각 데이터가 추가될수록 AI 기능이 자동으로 강화됩니다.

### 1. 예규·판례 (Regulation & Precedent)

**추가 시 기대 효과**:

- 법령의 해석과 적용 기준을 더욱 명확하게 제공
- 실제 판례를 바탕으로 구체적인 사례 분석 가능
- 법령 조문과 판례를 연결하여 종합적인 법률 분석 제공

**구현 방식**:

- `RegulationMetadata`, `PrecedentMetadata` 클래스 생성
- 예규·판례 데이터를 벡터 임베딩으로 변환
- 검색 시 `documentType` 필터로 예규·판례만 검색 가능
- 법령 조문과 예규·판례를 연관 검색하여 통합 답변 생성

**AI 기능 강화 예시**:

```
질문: "부가가치세 면세 사업자의 기준은?"
→ 법령 조문: "부가가치세법 제 12조" 검색
→ 예규: "부가가치세법 시행령" 검색
→ 판례: "부가가치세 면세 관련 대법원 판례" 검색
→ 법령 + 예규 + 판례를 종합한 포괄적 답변 생성
```

### 2. 실무해설 (Practical Commentary)

**추가 시 기대 효과**:

- 법령의 실무 적용 방법에 대한 전문가 해설 제공
- 복잡한 법령을 실무 관점에서 쉽게 이해할 수 있도록 설명
- 실제 업무에 바로 적용 가능한 구체적인 가이드라인 제공

**구현 방식**:

- `CommentaryMetadata` 클래스 생성
- 실무해설 문서를 주제별, 법령별로 분류하여 임베딩
- 법령 조문과 실무해설을 연관 검색
- 실무 전문가의 관점을 반영한 실용적인 답변 생성

**AI 기능 강화 예시**:

```
질문: "법인세 신고서 작성 시 주의사항은?"
→ 법령 조문: "법인세법 관련 조문" 검색
→ 실무해설: "법인세 신고서 작성 가이드" 검색
→ 법령의 요구사항 + 실무 작성 팁을 결합한 답변 생성
```

### 3. 텍스넷 포스트 (TaxNet Post)

**추가 시 기대 효과**:

- 최신 세무 동향과 실무 이슈를 반영한 답변 제공
- 커뮤니티의 질문과 답변을 활용하여 다양한 관점 제공
- 실시간으로 업데이트되는 최신 정보 활용 가능

**구현 방식**:

- `TaxNetPostMetadata` 클래스 생성
- 포스트의 제목, 내용, 태그, 작성일 등을 메타데이터로 저장
- 인기 포스트, 최신 포스트 등 다양한 검색 전략 지원
- 커뮤니티 지식을 활용한 보다 풍부한 답변 생성

**AI 기능 강화 예시**:

```
질문: "2024년 세법 개정사항 중 주목할 만한 것은?"
→ 법령 조문: "2024년 개정 법령" 검색
→ 텍스넷 포스트: "2024년 세법 개정 관련 토론" 검색
→ 최신 법령 + 커뮤니티 토론을 반영한 시의성 있는 답변 생성
```

### 4. 기타 확장 가능한 데이터 소스

- **세무공무원 해석례**: 공식 해석을 통한 법령 적용 기준 명확화
- **세무사 협회 가이드라인**: 전문가 기관의 가이드라인 활용
- **국세청 공지사항**: 최신 공식 공지사항 반영
- **세법 개정 이력**: 법령의 변천 과정과 개정 배경 제공
- **FAQ 데이터**: 자주 묻는 질문과 답변을 통한 빠른 응답

---

## 💡 데이터 추가에 따른 AI 기능 강화 메커니즘

### 1. 벡터 검색 품질 향상

**원리**:

- 더 많은 관련 문서가 벡터 스토어에 저장될수록 유사도 검색의 정확도 향상
- 다양한 관점의 문서를 통해 검색 결과의 다양성 확보
- 문서 간 연관성을 통한 컨텍스트 확장

**예시**:

```
데이터 추가 전:
질문 → 법령 조문 3건 검색 → 제한적인 답변

데이터 추가 후:
질문 → 법령 조문 3건 + 예규 2건 + 판례 2건 + 실무해설 2건 검색
→ 풍부한 컨텍스트를 바탕으로 종합적이고 정확한 답변 생성
```

### 2. 답변 정확도 향상

**원리**:

- 여러 데이터 소스에서 동일한 정보를 확인하여 답변의 신뢰도 향상
- 서로 다른 데이터 소스 간의 상호 검증 가능
- 법령의 해석과 적용에 대한 다양한 관점 제공

**예시**:

```
법령 조문만 있을 때:
"법령에 따르면 A입니다." (단순 인용)

여러 데이터 소스 추가 후:
"법령에 따르면 A입니다.
예규에서는 이를 B로 해석하고 있으며,
실제 판례에서는 C 경우에 D로 적용되었습니다.
실무에서는 E 방법을 권장합니다." (종합적 분석)
```

### 3. 답변 다양성 확보

**원리**:

- 다양한 데이터 소스를 통해 같은 질문에 대해 다양한 관점의 답변 가능
- 사용자의 수준과 목적에 맞는 답변 선택 가능
- 법령 중심, 실무 중심, 최신 동향 중심 등 다양한 스타일의 답변 제공

**예시**:

```
기본 답변: 법령 조문 기반 답변
+ 예규 추가: 법령 해석 기준 추가
+ 실무해설 추가: 실무 적용 방법 추가
+ 텍스넷 포스트 추가: 최신 이슈와 다양한 관점 추가
```

### 4. 자동 연관 검색 강화

**원리**:

- 각 데이터 소스의 메타데이터에 연관 정보를 저장
- 한 데이터를 검색하면 연관된 다른 데이터 소스도 자동 검색
- 데이터가 많아질수록 연관 검색의 정확도와 범위 확대

**예시**:

```
상담 사례 검색
→ 연관 법령 조문 자동 검색
→ (예규 추가 시) 연관 예규 자동 검색
→ (판례 추가 시) 관련 판례 자동 검색
→ (실무해설 추가 시) 관련 실무해설 자동 검색
```

---

## 🔧 확장성 보장을 위한 아키텍처 설계

### 1. 메타데이터 인터페이스 기반 설계

모든 문서 타입은 `DocumentMetadata` 인터페이스를 구현:

```java
public interface DocumentMetadata {
    Map<String, Object> toMap();  // 벡터 스토어 저장용
    String getDocumentType();     // 문서 타입 식별
}
```

**장점**:

- 새로운 문서 타입 추가 시 기존 코드 수정 불필요
- 일관된 방식으로 모든 문서 타입 처리 가능
- 문서 타입별 필터링 및 검색 자동 지원

### 2. 확장 가능한 검색 서비스

`ConsultationSearchService`는 `documentType` 필터를 통해 다양한 문서 타입 검색 지원:

```java
// 상담 데이터만 검색
filterExpression("documentType == 'counsel'")

// 법령 조문만 검색
filterExpression("documentType == 'lawArticle'")

// 향후 예규만 검색 (추가 시)
filterExpression("documentType == 'regulation'")
```

**장점**:

- 새로운 문서 타입 추가 시 필터만 추가하면 검색 가능
- 여러 문서 타입을 조합한 하이브리드 검색 자동 지원
- 검색 전략을 유연하게 변경 가능

### 3. 자동 연관 검색 메커니즘

각 문서의 메타데이터에 연관 정보를 저장하여 자동 연관 검색:

```java
// 상담 메타데이터에 연관 법령 정보 저장
lawIds: ["LAW001", "LAW002"]
articleKeys: ["0018031", "0015021"]
lawArticlePairs: ["LAW001:0018031", "LAW002:0015021"]
```

**장점**:

- 새로운 문서 타입 추가 시 메타데이터만 정의하면 자동 연관 검색 가능
- 문서 간 연관성을 자동으로 활용
- 검색 결과의 풍부함 자동 확보

---

## 📈 데이터 추가 시 기대 효과

### 정량적 효과

| 데이터 소스     | 검색 결과 다양성 | 답변 정확도 | 사용자 만족도 |
| --------------- | ---------------- | ----------- | ------------- |
| 법령 조문만     | ⭐⭐             | ⭐⭐⭐      | ⭐⭐          |
| + 상담 데이터   | ⭐⭐⭐           | ⭐⭐⭐⭐    | ⭐⭐⭐        |
| + 예규·판례     | ⭐⭐⭐⭐         | ⭐⭐⭐⭐⭐  | ⭐⭐⭐⭐      |
| + 실무해설      | ⭐⭐⭐⭐⭐       | ⭐⭐⭐⭐⭐  | ⭐⭐⭐⭐⭐    |
| + 텍스넷 포스트 | ⭐⭐⭐⭐⭐       | ⭐⭐⭐⭐⭐  | ⭐⭐⭐⭐⭐    |

### 정성적 효과

1. **답변의 깊이**: 단순 법령 인용에서 법령 + 해석 + 사례 + 실무 가이드까지 종합적 답변
2. **답변의 신뢰도**: 여러 소스 간 상호 검증을 통한 높은 신뢰도
3. **답변의 실용성**: 이론적 법령 설명에서 실제 적용 가능한 실무 가이드로 발전
4. **답변의 시의성**: 최신 동향과 이슈를 반영한 시의성 있는 답변

---

## 🎯 결론

**AIAgent 프로젝트**는 현재 법령 조문과 상담 데이터를 기반으로 한 법률 상담 AI 시스템으로 출발했지만, 그 진정한 가치는 **확장 가능한 아키텍처**에 있습니다.

### 핵심 메시지

> **데이터가 추가될수록 AI 기능은 자동으로 강화됩니다.**

- 새로운 데이터 소스를 추가하는 것은 단순히 데이터를 늘리는 것이 아니라, **AI의 지식과 능력을 확장**하는 것입니다.
- 각 데이터 소스는 서로 보완하며, 통합 검색을 통해 **단일 데이터 소스로는 불가능한 종합적이고 정확한 답변**을 생성합니다.
- 확장 가능한 아키텍처를 통해 **기존 시스템 수정 없이** 새로운 데이터 소스를 추가할 수 있어, **지속적인 성장과 개선**이 가능합니다.

### 향후 비전

예규·판례, 실무해설, 텍스넷 포스트 등 다양한 데이터 소스를 추가함으로써, AIAgent는 단순한 법령 검색 도구를 넘어서 **법률 전문가 수준의 종합적이고 실용적인 상담 서비스**를 제공하는 시스템으로 발전할 수 있습니다.

---

**작성일**: 2025-01-29  
**프로젝트**: AIAgent (LangGraph4j 기반 AI 에이전트)  
**버전**: 0.0.1-SNAPSHOT
